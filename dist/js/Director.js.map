{"version":3,"sources":["../../js/Director.js"],"names":["Director","instance","dataStore","DataStore","getInstance","moveSpeed","minTop","window","innerHeight","maxTop","top","Math","random","get","push","UpPencil","DownPencil","i","y","birdsY","time","birds","land","pencils","score","birdsHeight","isGameOver","birdsBorder","bottom","left","birdsX","right","birdsWidth","length","pencil","pencilBorder","height","x","width","isStrike","console","log","isScore","scoreNumber","check","draw","shift","innerWidth","createPencil","forEach","value","index","array","timer","requestAnimationFrame","run","put","cancelAnimationFrame","destroy","bird","s"],"mappings":"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","file":"Director.js","sourcesContent":["//导演类，控制游戏的逻辑\r\nimport {DataStore} from \"./base/DataStore.js\";\r\nimport {UpPencil} from \"./runtime/UpPencil.js\";\r\nimport {DownPencil} from \"./runtime/DownPencil.js\";\r\n\r\nexport class Director {\r\n\r\n    static getInstance() {\r\n        if (!Director.instance) {\r\n            Director.instance = new Director();\r\n        }\r\n        return Director.instance;\r\n    }\r\n\r\n    constructor() {\r\n        this.dataStore = DataStore.getInstance();\r\n        this.moveSpeed = 2;\r\n\r\n    }\r\n\r\n    createPencil() {\r\n        const minTop = window.innerHeight / 8;\r\n        const maxTop = window.innerHeight / 2;\r\n        const top = minTop + Math.random() * (maxTop - minTop);\r\n        this.dataStore.get('pencils').push(new UpPencil(top));\r\n        this.dataStore.get('pencils').push(new DownPencil(top));\r\n    }\r\n\r\n    birdsEvent() {\r\n        for (let i = 0; i <= 2; i++) {\r\n            this.dataStore.get('birds').y[i] =\r\n                this.dataStore.get('birds').birdsY[i];\r\n        }\r\n        this.dataStore.get('birds').time = 0;\r\n    }\r\n\r\n    //判断小鸟是否和铅笔撞击\r\n    static isStrike(bird, pencil) {\r\n        let s = false;\r\n        if (bird.top > pencil.bottom ||\r\n            bird.bottom < pencil.top ||\r\n            bird.right < pencil.left ||\r\n            bird.left > pencil.right) {\r\n            s = true;\r\n        }\r\n\r\n        return !s;\r\n    }\r\n\r\n    //判断小鸟是否撞击地板和铅笔\r\n    check() {\r\n        const birds = this.dataStore.get('birds');\r\n        const land = this.dataStore.get('land');\r\n        const pencils = this.dataStore.get('pencils');\r\n        const score = this.dataStore.get('score');\r\n\r\n        //地板的撞击判断\r\n        if (birds.birdsY[0] + birds.birdsHeight[0] >= land.y) {\r\n            this.isGameOver = true;\r\n            return;\r\n        }\r\n        //小鸟的边框模型\r\n        const birdsBorder = {\r\n            top: birds.y[0],\r\n            bottom: birds.y[0] + birds.birdsHeight[0],\r\n            left: birds.birdsX[0],\r\n            right: birds.birdsX[0] + birds.birdsWidth[0]\r\n        };\r\n        const length = pencils.length;\r\n        for (let i = 0; i < length; i++) {\r\n\r\n            const pencil = pencils[i];\r\n            const pencilBorder = {\r\n                top: pencil.y,\r\n                bottom: pencil.y + pencil.height,\r\n                left: pencil.x,\r\n                right: pencil.x + pencil.width\r\n            };\r\n            if (Director.isStrike(birdsBorder, pencilBorder)) {\r\n                console.log('撞到水管啦');\r\n                this.isGameOver = true;\r\n                return;\r\n            }\r\n        }\r\n        //加分逻辑\r\n        if(birds.birdsX[0]>pencils[0].x+pencils[0].width\r\n            &&score.isScore){\r\n            score.isScore = false;\r\n            score.scoreNumber++;\r\n        }\r\n\r\n    }\r\n\r\n    run() {\r\n        this.check();\r\n        if (!this.isGameOver) {\r\n            this.dataStore.get('background').draw();\r\n\r\n            const pencils = this.dataStore.get('pencils');\r\n            if (pencils[0].x + pencils[0].width <= 0 &&\r\n                pencils.length === 4) {\r\n                pencils.shift();\r\n                pencils.shift();\r\n                this.dataStore.get('score').isScore = true;\r\n            }\r\n            if (pencils[0].x <= (window.innerWidth - pencils[0].width) / 2 && pencils.length === 2) {\r\n                this.createPencil();\r\n            }\r\n            this.dataStore.get('pencils').forEach(function (value, index, array) {\r\n                value.draw();\r\n            });\r\n            this.dataStore.get('land').draw();\r\n            this.dataStore.get('score').draw();\r\n            this.dataStore.get('birds').draw();\r\n            let timer = requestAnimationFrame(() => this.run());\r\n            this.dataStore.put('timer', timer);\r\n        } else {\r\n            console.log(\"游戏结束\");\r\n            this.dataStore.get('startButton').draw();\r\n            cancelAnimationFrame(this.dataStore.get('timer'));\r\n            this.dataStore.destroy();\r\n\r\n        }\r\n    }\r\n}"]}